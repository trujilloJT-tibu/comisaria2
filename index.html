<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> COMISAR√çA 2da ROSARIO</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.3.0/exceljs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <style>
        :root {
            --bg-main: #0f172a;
            --bg-card: #1e293b;
            --primary: #6366f1;
            --primary-hover: #4f46e5;
            --accent: #38bdf8;
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
            --border: #334155;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
        }

        /* --- DISE√ëO DE PANTALLA --- */
        @media screen {
            * { box-sizing: border-box; text-transform: uppercase; transition: all 0.2s ease; }
            
            body {
                background-color: var(--bg-main);
                color: var(--text-main);
                font-family: 'Inter', system-ui, -apple-system, sans-serif;
                margin: 0;
                padding: 10px;
                line-height: 1.5;
            }

            .container {
                width: 100%;
                max-width: 1300px;
                margin: 0 auto;
                padding: 15px;
            }

            header {
                text-align: center;
                padding: 20px 0;
                border-bottom: 1px solid var(--border);
                margin-bottom: 30px;
            }

            h1 {
                font-size: 1.8rem;
                letter-spacing: 2px;
                color: var(--accent);
                margin: 0;
                text-shadow: 0 0 15px rgba(56, 189, 248, 0.3);
            }

            .card {
                background: var(--bg-card);
                border-radius: 16px;
                border: 1px solid var(--border);
                padding: 24px;
                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
                margin-bottom: 25px;
            }

            .section-title {
                display: flex;
                align-items: center;
                gap: 10px;
                font-size: 1rem;
                font-weight: 700;
                color: var(--text-main);
                margin-bottom: 20px;
                padding-bottom: 10px;
                border-bottom: 2px solid var(--primary);
            }

            /* Grid del Formulario */
            .grid-form {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
                gap: 20px;
            }

            .form-group { display: flex; flex-direction: column; }
            
            label {
                font-size: 0.7rem;
                color: var(--text-muted);
                margin-bottom: 6px;
                font-weight: 700;
                letter-spacing: 0.5px;
            }

            input, select, textarea {
                background: #0f172a;
                border: 1px solid var(--border);
                color: #fff;
                padding: 12px 16px;
                border-radius: 8px;
                font-size: 0.9rem;
            }

            input:focus, textarea:focus {
                border-color: var(--primary);
                outline: none;
                box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
            }

            .full-row { grid-column: 1 / -1; }
            textarea { min-height: 80px; }

            /* Panel de Botones */
            .actions-panel {
                background: #231f57;
                border: 1px solid var(--primary);
                position: sticky;
                bottom: 20px;
                z-index: 100;
                display: flex;
                flex-direction: column;
                gap: 15px;
            }

            .button-group {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
                gap: 8px;
                width: 100%;
            }

            button {
                cursor: pointer;
                padding: 10px 15px;
                border: none;
                border-radius: 8px;
                font-weight: 700;
                font-size: 0.75rem;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 8px;
                color: white;
            }

            button:hover { transform: translateY(-2px); filter: brightness(1.1); }
            button:active { transform: translateY(0); }

            .btn-save { background: var(--success); grid-column: span 2; font-size: 1rem; }
            .btn-print { background: var(--primary); }
            .btn-secondary { background: #475569; }
            .btn-tool { background: #6366f1; }
            .btn-special { background: #db2777; }

            /* Tabla */
            .table-container { overflow-x: auto; margin-top: 20px; border-radius: 12px; }
            table { width: 100%; border-collapse: collapse; background: var(--bg-card); }
            th { background: #334155; color: var(--text-main); padding: 15px; text-align: left; font-size: 0.8rem; }
            td { padding: 12px 15px; border-bottom: 1px solid var(--border); font-size: 0.85rem; }
            
            /* ESTILOS DE COMPRESI√ìN POR FECHA - MODIFICADO: SIEMPRE ABIERTO */
            .fecha-header {
                background: #334155 !important;
                color: var(--accent);
                font-weight: bold;
                text-align: left;
                padding: 12px 20px;
                border-bottom: 2px solid var(--bg-main);
                display: flex;
                justify-content: space-between;
                align-items: center;
                user-select: none;
            }

            /* Estilo para los checkboxes r√°pidos en tabla */
            .check-cell { text-align: center; min-width: 45px; }
            .check-cell input { width: 18px; height: 18px; cursor: pointer; }

            #printArea { display: none; }

            /* Editor */
            #editorElevacion {
                width: 100%; min-height: 400px; background: white; color: black;
                padding: 40px; border-radius: 8px; font-family: Arial, sans-serif;
                text-transform: none; margin: 10px 0;
            }

            /* Responsive para Celulares */
            @media (max-width: 768px) {
                h1 { font-size: 1.3rem; }
                .btn-save { grid-column: span 1; }
                .grid-form { grid-template-columns: 1fr; }
                .container { padding: 5px; }
                .actions-panel { position: relative; bottom: 0; }
            }
        }

        /* --- DISE√ëO DE IMPRESI√ìN --- */
        @media print {
            @page { 
                size: A4; 
                margin: 1cm;
            }
            
            html, body {
                height: 99%;
                overflow: hidden;
            }

            body * { visibility: hidden; text-transform: uppercase; }
            
            #printArea, #printArea * { 
                visibility: visible; 
            }

            #printArea {
                display: block !important; 
                position: absolute; 
                left: 0; 
                top: 0; 
                width: 100%;
                height: 100%;
                color: black; 
                background: white; 
                padding: 0;
                page-break-inside: avoid;
            }

            .print-ficha {
                padding-top: 1cm; 
                margin-left: 6.5cm; 
                width: 8cm;
                text-align: center; 
                font-family: "Courier New", monospace;
                font-size: 11pt; 
                line-height: 1.4; 
                font-weight: bold;
            }

            .print-doc {
                padding: 0.5cm 1.5cm;
                font-family: Arial, Helvetica, sans-serif;
                font-size: 10.5pt;
                line-height: 1.3; 
                color: black;
                max-height: 27cm;
            }

            .p-fecha { text-align: right; margin-bottom: 20px; }
            .p-ref { display: flex; justify-content: space-between; margin-bottom: 20px; font-weight: bold; }
            .p-cuerpo { text-align: justify; text-indent: 4cm; margin-bottom: 15px; }
            .p-firma { margin-top: 40px; text-align: right; font-weight: bold; line-height: 1.1; }

            .print-acta {
                padding: 0.5cm 1.2cm; 
                font-family: "Times New Roman", Times, serif;
                font-size: 10pt; 
                text-align: justify; 
                text-transform: none; 
                line-height: 1.2;
            }

            .acta-titulo { text-align: center; font-weight: bold; text-decoration: underline; font-size: 12pt; margin-bottom: 10px; }
            .acta-punto { margin-bottom: 5px; padding-left: 10px; }
            .planilla-linea { border-bottom: 1px solid black; display: inline-block; min-width: 250px; text-transform: uppercase; }
            
            pre { 
                white-space: pre-wrap !important; 
                word-wrap: break-word !important; 
                font-size: 10pt !important;
                margin: 5px 0 !important;
            }

            [contenteditable="true"] { border: none; outline: none; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>‚úô COMISAR√çA 2da ROSARIO ‚úô</h1>
        </header>
        
        <form id="registroForm">
            <div class="card">
                <div class="section-title">üë§ IDENTIDAD DEL DEMORADO</div>
                <div class="grid-form">
                    <div class="form-group"><label>Nombre y Apellido</label><input type="text" id="nombreCompleto" placeholder="Ej: JUAN PEREZ"></div>
                    <div class="form-group"><label>Apodo / Alias</label><input type="text" id="apodo" value="NO TIENE"></div>
                    <div class="form-group"><label>DNI / Documento</label><input type="text" id="dni"></div>
                    <div class="form-group"><label>Hijo de (Padre)</label><input type="text" id="padre"></div>
                    <div class="form-group"><label>Hijo de (Madre)</label><input type="text" id="madre"></div>
                    <div class="form-group"><label>Fecha de Nacimiento</label><input type="date" id="fechaNac"></div>
                    <div class="form-group"><label>Edad</label><input type="text" id="edad"></div>
                    <div class="form-group"><label>Estado Civil</label><input type="text" id="estadoCivil" value="SOLTERO"></div>
                    <div class="form-group"><label>Nacionalidad</label><input type="text" id="nacionalidad" value="ARGENTINO"></div>
                    <div class="form-group"><label>Domicilio Real</label><input type="text" id="domicilio"></div>
                    <div class="form-group"><label>Ciudad</label><input type="text" id="ciudad" value="ROSARIO"></div>
                    <div class="form-group"><label>Provincia</label><input type="text" id="provincia" value="SANTA FE"></div>
                </div>
            </div>

            <div class="card">
                <div class="section-title">‚öñÔ∏è DATOS DE LA CAUSA Y BIENES</div>
                <div class="grid-form">
                    <div class="form-group full-row"><label>Antecedentes Penales</label><textarea id="antecedentes"></textarea></div>
                    <div class="form-group full-row"><label>Capturas y Paraderos</label><textarea id="capturas"></textarea></div>
                    <div class="form-group"><label>Causa por la que lo traen</label><input type="text" id="causaIngreso"></div>
                    <div class="form-group"><label>Calificaci√≥n Final</label><input type="text" id="causaFinal"></div>
                    <div class="form-group"><label>Nombre V√≠ctima</label><input type="text" id="victima" value="LA LLAMADA"></div>
                    <div class="form-group"><label>Domicilio V√≠ctima</label><input type="text" id="domicilioVictima"></div>
                    <div class="form-group full-row"><label>Secuestro</label><textarea id="secuestro"></textarea></div>
                    <div class="form-group full-row"><label>Pertenencias</label><textarea id="pertenencias"></textarea></div>
                    <div class="form-group"><label>NROCAUSA</label><input type="text" id="nroCausa"></div>
                    <div class="form-group"><label>N√∫mero de Prio</label><input type="text" id="nroPrio"></div>
                    <div class="form-group"><label>Fiscal√≠a</label><input type="text" id="fiscalia"></div>
                    <div class="form-group"><label>Fecha del Hecho</label><input type="date" id="fechaApreh"></div>
                    <div class="form-group"><label>Oficial Sumariante</label><input type="text" id="sumariante" value="SUB OFICIAL TRUJILLO"></div>
                    <div class="form-group"><label>Orden Judicial</label><input type="text" id="orden" value="QUEDA DETENIDO"></div>
                    <input type="hidden" id="elevacionPersonalizada">
                </div>
            </div>

            <div class="card actions-panel">
                <div class="section-title" style="margin-bottom:10px; border:none">‚ö° DOCUMENTACI√ìN</div>
                <div class="button-group">
                    <button type="button" class="btn-save" onclick="guardarDato()">üíæ GUARDAR EN RED</button>
                    
                    <button type="button" class="btn-print" onclick="imprimir('ficha')">üñ®Ô∏è FICHA</button>
                    <button type="button" class="btn-print" onclick="imprimir('planilla')">üìù PLANILLA</button>
                    <button type="button" class="btn-print" onclick="imprimir('cotejo')">üìÑ COTEJO</button>
                    <button type="button" class="btn-print" style="background:#4338ca" onclick="imprimir('afis')">üÜî AFIS</button>
                    <button type="button" class="btn-special" onclick="imprimir('insercion')">üì• INSERCI√ìN</button>
                    <button type="button" class="btn-print" onclick="imprimir('acta')">üìú DERECHOS</button>
                    
                    <button type="button" class="btn-secondary" onclick="imprimir('const_domicilio')">üè† CONST. DOM.</button>
                    <button type="button" class="btn-secondary" onclick="imprimir('prohibicion')">üö´ PROHIBICION</button>
                    <button type="button" class="btn-secondary" onclick="imprimir('entrega_rodado')">üèçÔ∏è ENT. RODADO</button>
                    <button type="button" class="btn-secondary" onclick="imprimir('nota_medico')">‚öïÔ∏è NOTA MEDICO</button>
                    <button type="button" class="btn-secondary" onclick="imprimir('notificacion')">üîî NOTIFICACION</button>
                    <button type="button" class="btn-secondary" onclick="imprimir('entrega_pert')">üì¶ ENT. PERTEN.</button>
                    
                    <button type="button" class="btn-tool" style="background: #2563eb;" onclick="abrirEditorElevacion()">üìÑ ELEVACI√ìN</button>
                    <button type="button" class="btn-tool" onclick="exportarExcel()">üìä EXCEL</button>
                    <button type="button" class="btn-tool" onclick="document.getElementById('inputExcel').click()">üì• IMPORTAR</button>
                </div>
                <button type="button" onclick="Nuevo()" style="background:#475569; width: 100%;">üßπ Nuevo FORMULARIO</button>
                <input type="file" id="inputExcel" style="display:none" accept=".xlsx" onchange="leerExcel(this)">
            </div>
            
            <div id="contenedorEditor" style="display:none; margin-top:20px; width:100%;">
                <div class="card" style="background: #f1f5f9;">
                    <div class="section-title" style="color: #0f172a; border-color:#0f172a">üìù EDITOR DE ELEVACI√ìN</div>
                    <div id="editorElevacion" contenteditable="true"></div>
                    <div class="button-group" style="margin-top:15px;">
                        <button type="button" class="btn-save" onclick="prepararImpresionElevacion()">üñ®Ô∏è CONFIRMAR E IMPRIMIR</button>
                        <button type="button" class="btn-secondary" onclick="document.getElementById('contenedorEditor').style.display='none'">‚ùå CANCELAR</button>
                    </div>
                </div>
            </div>
        </form>

        <div class="card">
            <div class="section-title">üìã REGISTROS (M√âDICO | DOM | ANT | FOTO)</div>
            <div class="table-container">
                <table id="tablaRegistros">
                    <thead>
                        <tr>
                            <th>APREHENDIDO</th>
                            <th>DNI</th>
                            <th class="check-cell" title="M√©dico">ü©∫</th>
                            <th class="check-cell" title="Domicilio">üè†</th>
                            <th class="check-cell" title="Antecedentes">üìú</th>
                            <th class="check-cell" title="Foto">üì∏</th>
                            <th>ACCIONES</th>
                        </tr>
                    </thead>
                    <tbody id="cuerpoTabla"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="printArea"></div>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDGXXj11PQJPCea2v_YmyNg0cR2U0GqxkA",
            authDomain: "comisaria2da-cc0ea.firebaseapp.com",
            projectId: "comisaria2da-cc0ea",
            storageBucket: "comisaria2da-cc0ea.firebasestorage.app",
            messagingSenderId: "317044163335",
            appId: "1:317044163335:web:ec6f0209fbbd03225b3ba2",
            measurementId: "G-CYJXQ8H9TH"
        };

        firebase.initializeApp(firebaseConfig);
        const dbCloud = firebase.firestore();

        let db = [];
        let indexEdit = null;

        dbCloud.collection("registros").orderBy("timestamp", "desc")
            .onSnapshot((snapshot) => {
                db = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderTabla();
            });

        // FUNCI√ìN NUEVA: ACTUALIZAR CHECKBOXES DIRECTO EN FIREBASE
        async function actualizarCheck(id, campo, valor) {
            const data = {};
            data[campo] = valor;
            await dbCloud.collection("registros").doc(id).update(data);
        }

        async function guardarDato() {
            const campos = document.querySelectorAll('#registroForm input, #registroForm textarea');
            const r = {};
            campos.forEach(c => r[c.id] = c.value.toUpperCase());
            r.timestamp = firebase.firestore.FieldValue.serverTimestamp();

            try {
                if (indexEdit !== null) {
                    const id = db[indexEdit].id;
                    await dbCloud.collection("registros").doc(id).update(r);
                    indexEdit = null;
                } else {
                    await dbCloud.collection("registros").add(r);
                }
                document.getElementById('registroForm').reset();
                alert("‚úÖ SINCRONIZADO CON √âXITO");
            } catch (error) {
                alert("‚ùå ERROR: Verifique conexi√≥n.");
            }
        }

        async function eliminarDato(i) {
            if(confirm("¬øELIMINAR ESTE REGISTRO?")) {
                const id = db[i].id;
                await dbCloud.collection("registros").doc(id).delete();
                indexEdit = null;
            }
        }

        function renderTabla() {
            const tbody = document.getElementById('cuerpoTabla');
            tbody.innerHTML = '';

            const grupos = db.reduce((acc, r) => {
                let fechaKey = "SIN FECHA";
                if (r.timestamp) {
                    const d = r.timestamp.toDate ? r.timestamp.toDate() : new Date(r.timestamp);
                    fechaKey = d.toLocaleDateString('es-AR');
                } else if (r.fechaApreh) {
                    fechaKey = fF(r.fechaApreh);
                }
                if (!acc[fechaKey]) acc[fechaKey] = [];
                acc[fechaKey].push(r);
                return acc;
            }, {});

            Object.keys(grupos).forEach(fecha => {
                const header = document.createElement('tr');
                header.innerHTML = `
                    <td colspan="7" class="fecha-header">
                        üìÖ REGISTROS DEL D√çA: ${fecha} (${grupos[fecha].length})
                    </td>
                `;
                tbody.appendChild(header);

                grupos[fecha].forEach(r => {
                    const realIndex = db.findIndex(item => item.id === r.id);
                    const tr = document.createElement('tr');

                    tr.innerHTML = `
                        <td style="font-weight:bold">${r.nombreCompleto || ''}</td>
                        <td>${r.dni || ''}</td>
                        <td class="check-cell"><input type="checkbox" ${r.checkMed ? 'checked' : ''} onchange="actualizarCheck('${r.id}', 'checkMed', this.checked)"></td>
                        <td class="check-cell"><input type="checkbox" ${r.checkDom ? 'checked' : ''} onchange="actualizarCheck('${r.id}', 'checkDom', this.checked)"></td>
                        <td class="check-cell"><input type="checkbox" ${r.checkAnt ? 'checked' : ''} onchange="actualizarCheck('${r.id}', 'checkAnt', this.checked)"></td>
                        <td class="check-cell"><input type="checkbox" ${r.checkFoto ? 'checked' : ''} onchange="actualizarCheck('${r.id}', 'checkFoto', this.checked)"></td>
                        <td>
                            <button onclick="cargar(${realIndex})" style="background:var(--warning); display:inline-flex; padding:5px 10px;">EDITAR</button>
                            <button onclick="eliminarDato(${realIndex})" style="background:var(--danger); display:inline-flex; padding:5px 10px; margin-left:5px;">ELIMINAR</button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
            });
        }

        // Se elimin√≥ la funci√≥n toggleFecha para mantener la tabla siempre abierta

        function cargar(i) {
            indexEdit = i;
            const r = db[i];
            Object.keys(r).forEach(k => { if(document.getElementById(k)) document.getElementById(k).value = r[k]; });
            document.getElementById('contenedorEditor').style.display = 'none';
            window.scrollTo({top: 0, behavior: 'smooth'});
        }

        function Nuevo() { 
            document.getElementById('registroForm').reset(); 
            document.getElementById('contenedorEditor').style.display = 'none';
            indexEdit = null; 
            const fechaApreh = document.getElementById('fechaApreh');
            const hoy = new Date().toISOString().split('T')[0];
            fechaApreh.value = hoy;
        }

        function fF(f) { return f ? f.split('-').reverse().join('/') : ""; }
        function getHoy() {
            const d = new Date();
            const opciones = { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' };
            return `ROSARIO, ${d.toLocaleDateString('es-AR', opciones)}`.toUpperCase();
        }

        function abrirEditorElevacion() {
            const r = indexEdit !== null ? db[indexEdit] : null;
            if(!r) return alert("SELECCIONE UN REGISTRO PRIMERO");
            const editor = document.getElementById('editorElevacion');
            const contenedor = document.getElementById('contenedorEditor');
            
            if(r.elevacionPersonalizada && r.elevacionPersonalizada.trim() !== "") {
                editor.innerHTML = r.elevacionPersonalizada;
            } else {
                const hoy = getHoy();
                editor.innerHTML = `
                    <div style="font-family: Arial; font-size: 11pt; line-height: 1.5;">
                        <div style="text-align: right;">${hoy}.-</div>
                        <p>MINISTERIO PUBLICO DE LA ACUSACION<br>FISCALIA DE FLAGRANCIA Y TURNO.<br>‚Äú FISCAL‚Äù</p>
                        <p>A.U.O.P.<br>Cr√≠a. 2da.<br>Nota Nro.________/26.- &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; OBJETO: ELEVAR ACTUACIONES<br>Ref. CAUSA ‚Äú${r.nroCausa || ''}‚Äù/26</p>
                        <p style="text-align: justify; text-indent: 5cm;">Por medio de la presente elevo a Usted, en referencia a actuaciones por un hecho caratulado a prima facie "${r.causaFinal || ''}", en donde resultare victima la llamada "${r.victima || ''}" e imputado el llamado "${r.nombreCompleto || ''}" para su conocimiento, consideraci√≥n y dem√°s fines legales que estime corresponder.-</p>
                        <br><p>Saludo a Ud. muy atte.</p><br><br>
                        <div style="text-align: right;">${r.sumariante || ''}<br>COMISARIA 2¬∞ URII</div>
                    </div>`;
            }
            contenedor.style.display = 'block';
            window.scrollTo({top: contenedor.offsetTop, behavior: 'smooth'});
        }

        async function prepararImpresionElevacion() {
            const contenido = document.getElementById('editorElevacion').innerHTML;
            const id = db[indexEdit].id;
            await dbCloud.collection("registros").doc(id).update({ elevacionPersonalizada: contenido });
            const area = document.getElementById('printArea');
            area.innerHTML = `<div class="print-doc">${contenido}</div>`;
            window.print();
        }

        function imprimir(tipo) {
            const r = indexEdit !== null ? db[indexEdit] : db[db.length - 1];
            if(!r) return alert("SIN DATOS PARA IMPRIMIR");
            
            if((tipo === 'acta' || tipo === 'insercion') && (!r.causaFinal || r.causaFinal.trim() === "")) {
                return alert("ERROR: FALTA CALIFICACI√ìN LEGAL FINAL.");
            }

            const area = document.getElementById('printArea');
            const fechaN = fF(r.fechaNac);
            const fechaA = fF(r.fechaApreh);
            const hoy = getHoy();

            if(tipo === 'ficha') {
                area.innerHTML = `<div class="print-ficha"><div>${r.nombreCompleto}</div><div style="margin-bottom:1.5em"></div><div>${r.padre}</div><div>${r.madre}</div><div>${r.nacionalidad}</div><div>${r.provincia}</div><div>${r.ciudad}</div><div>${fechaN} &nbsp; ${r.edad} A√ëOS</div><div>D.N.I. N¬∫ ${r.dni}</div><div style="margin-bottom:1.5em"></div><div>${r.domicilio}</div></div>`;
            }
            else if(tipo === 'planilla') {
                area.innerHTML = `<div class="print-doc"><div class="p-fecha">${hoy}</div><h2 style="text-align:center; text-decoration:underline; margin-bottom:15px; font-size:12pt">PLANILLA DE FILIACION PRONTUARIAL</h2><p><strong>APELLIDO Y NOMBRES:</strong> <span class="planilla-linea">${r.nombreCompleto}</span></p><p><strong>APODO / ALIAS:</strong> <span class="planilla-linea">${r.apodo}</span></p><p><strong>HIJO DE (PADRE):</strong> <span class="planilla-linea">${r.padre}</span></p><p><strong>HIJO DE (MADRE):</strong> <span class="planilla-linea">${r.madre}</span></p><p><strong>NACIONALIDAD:</strong> <span class="planilla-linea">${r.nacionalidad}</span></p><p><strong>ESTADO CIVIL:</strong> <span class="planilla-linea">${r.estadoCivil}</span></p><p><strong>FECHA DE NACIMIENTO:</strong> <span class="planilla-linea">${fechaN}</span></p><p><strong>EDAD:</strong> <span class="planilla-linea">${r.edad} A√ëOS</span></p><p><strong>DOMICILIADO EN CALLE:</strong> <span class="planilla-linea">${r.domicilio}</span></p><p><strong>DOCUMENTO TIPO:</strong> <span class="planilla-linea">D.N.I N¬∞ ${r.dni}</span></p><p><strong>PRIO N¬∞:</strong> <span class="planilla-linea">${r.nroPrio}</span></p><div style="margin-top:10px"><strong>CAPTURAS Y/O PARADEROS:</strong><pre style="white-space: pre-wrap; font-family: Arial; font-size: 10pt; margin-top: 5px; text-transform: uppercase;">${r.capturas}</pre></div><div style="margin-top:10px"><strong>ANTECEDENTES PENALES:</strong><pre style="white-space: pre-wrap; font-family: Arial; font-size: 10pt; margin-top: 5px; text-transform: uppercase;">${r.antecedentes}</pre></div><p style="font-size:9pt; margin-top:15px"><strong>NOTA:</strong> DATOS SUMINISTRADOS VIA TELEFONICA POR OFICINA 10 PDI.</p><div class="p-firma">${r.sumariante}<br>COMISARIA 2¬∞ URII</div></div>`;
            }
            else if(tipo === 'cotejo') {
                area.innerHTML = `
                    <div class="print-doc">
                        <div class="p-fecha">${hoy}.-</div>
                        <p><strong>SE√ëOR JEFE DE DACTILOSCOPIA<br>DIVISION CRIMINALISTICA - UNIDAD REGIONAL II</strong><br>S________________/___________________D</p>
                        <div class="p-ref">
                            <div>A.U.O.P.- CR√çA. 2¬∞<br>NOTA N¬∫ ________/26-</div>
                            <div>OBJETO: COTEJO DE FICHAS</div>
                        </div>
                        <div class="p-cuerpo">POR MEDIO DE LA PRESENTE, REMITO A UD. UN JUEGO DE FICHAS DACTILOSC√ìPICAS DE QUIEN DICE LLAMARSE ${r.nombreCompleto}, DE NACIONALIDAD ${r.nacionalidad}, NACIDO EL D√çA ${fechaN}, DE ${r.edad} A√ëOS DE EDAD, TITULAR DEL D.N.I. N¬∫ ${r.dni}, HIJO DE ${r.padre} Y DE ${r.madre}, CON DOMICILIO EN CALLE ${r.domicilio} DE LA CIUDAD DE ${r.ciudad}, PROVINCIA DE ${r.provincia}, A LOS FINES DE QUE SE REALICE EL CORRESPONDIENTE COTEJO DE FICHAS, HACIENDO CONSTAR QUE EL MISMO SE ENCUENTRA DEMORADO POR EL HECHO ${r.causaIngreso}, QUE SE INVESTIGA A DISPOSICI√ìN DEL FISCAL DE FLAGRANCIA EN TURNO ${r.fiscalia}, EN RELACI√ìN A LA CAUSA ${r.causaFinal}.</p>
                        <div class="p-firma" style="margin-top: 4cm;">SALUDA A UD. ATTE.<br><br><br>${r.sumariante}<br>COMISARIA 2¬∞ URII</div>
                    </div>`;
            }
            else if(tipo === 'afis') {
                area.innerHTML = `
                    <div class="print-doc">
                        <div class="p-fecha">${hoy}.-</div>
                        <p><strong>SE√ëOR JEFE SECCION AFIS, U.R II</strong><br>S________________/___________________D</p>
                        <div class="p-ref">
                            <div>A.U.O.P.- CR√çA. 2¬∞<br>NOTA N¬∫ ________/26-</div>
                            <div>OBJETO: COTEJO DE FICHAS</div>
                        </div>
                        <div class="p-cuerpo">POR MEDIO DE LA PRESENTE, REMITO A UD. UN JUEGO DE FICHAS DACTILOSC√ìPICAS DE QUIEN DICE LLAMARSE ${r.nombreCompleto}, DE NACIONALIDAD ${r.nacionalidad}, NACIDO EL D√çA ${fechaN}, DE ${r.edad} A√ëOS DE EDAD, TITULAR DEL D.N.I. N¬∫ ${r.dni}, HIJO DE ${r.padre} Y DE ${r.madre}, CON DOMICILIO EN CALLE ${r.domicilio} DE LA CIUDAD DE ${r.ciudad}, PROVINCIA DE ${r.provincia}, A LOS FINES DE QUE SE REALICE EL CORRESPONDIENTE COTEJO DE FICHAS, HACIENDO CONSTAR QUE EL MISMO SE ENCUENTRA DEMORADO, QUE SE INVESTIGA A DISPOSICI√ìN DEL FISCAL DE FLAGRANCIA EN TURNO ${r.fiscalia}.</p>
                        <p style="text-align: center; font-weight: bold; margin-top: 15px;">SE ESPERA PRONTA RESPUESTA AL CORREO OFICIAL CONSMPA-UR2CRIA2@SANTAFE.GOV.AR.-</p>
                        <p style="text-align: center; font-weight: bold; margin-top: 5px;">NO SIENDO PARA M√ÅS RUEGO DARLE A LA PRESENTE CAR√ÅCTER DE URGENTE DESPACHO.-</p>
                        <div class="p-firma" style="margin-top: 3cm;">SALUDA A UD. ATTE.<br><br><br>${r.sumariante}<br>COMISARIA 2¬∞ URII</div>
                    </div>`;
            }
            else if(tipo === 'insercion') {
                area.innerHTML = `
                    <div class="print-doc">
                        <div class="p-fecha">${hoy}.-</div>
                        <p><strong>SE√ëOR JEFE DE DACTILOSCOPIA<br>DIVISION CRIMINALISTICA - UNIDAD REGIONAL II</strong></p>
                        <div class="p-ref">
                            <div>A.U.O.P.- CR√çA. 2¬∞<br>NOTA N¬∫ ________/26-</div>
                            <div style="text-align:right">OBJETO: INSERCI√ìN DE CAUSA Y<br>PLANILLA PRONTUARIAL<br>CAUSA N¬∫ ${r.nroCausa}</div>
                        </div>
                        <div class="p-cuerpo">POR MEDIO DE LA PRESENTE, REMITO A UD. UN JUEGO DE FICHAS DACTILOSC√ìPICAS DE QUIEN DICE LLAMARSE <strong>${r.nombreCompleto}</strong>, NACIDO EN <strong>${fechaN}</strong>, D.N.I. N¬∫ <strong>${r.dni}</strong>, HIJO DE <strong>${r.padre}</strong> Y DE <strong>${r.madre}</strong>, CON DOMICILIO EN CALLE <strong>${r.domicilio}</strong> A LOS FINES DE QUE SE CLASIFIQUEN LAS MISMAS PARA LA CORRESPONDIENTE <strong>INSERCI√ìN DE CAUSA Y CONFECCI√ìN DE PLANILLA PRONTUARIAL</strong>, HACIENDO CONSTAR QUE EL CAUSANTE SE ENCUENTRA DEMORADO EN ESTA DEPENDENCIA POR EL HECHO A PRIMA FACIE DE <strong>"${r.causaFinal}"</strong>, A DISPOSICI√ìN DEL FISCAL DE FLAGRANCIA Y TURNO <strong>${r.fiscalia}</strong>.-</div>
                        <p style="text-indent: 4cm">SE ADJUNTA A LA PRESENTE NOTA COPIA DE ACTA DE PROCEDIMIENTO Y ACTA CIRCUNSTANCIADA.</p>
                        <div class="p-firma" style="margin-top: 4cm;">SALUDA A UD. ATTE.<br><br><br>${r.sumariante}<br>COMISARIA 2¬∞ URII</div>
                    </div>`;
            }
            else if(tipo === 'acta') {
                area.innerHTML = `
                    <div class="print-acta">
                        <div class="acta-titulo">ACTA DE CONOCIMIENTO DE DERECHOS DEL IMPUTADO</div>
                        <p><strong>Derechos del imputado - Art√≠culo 100 y 101 del C√≥digo Procesal Penal</strong></p>
                        <p>Toda persona detenida o indicada como autor o part√≠cipe de un hecho delictivo cuenta con los siguientes derechos:</p>
                        <div class="acta-punto">. Derecho a elegir un abogado defensor de su confianza o de oficio (SPPDP).</div>
                        <div class="acta-punto">. Derecho a conferenciar en forma privada y libre con su letrado defensor.</div>
                        <div class="acta-punto">. Derecho constitucional de no declarar sin que ello signifique presunci√≥n en su contra.</div>
                        <div class="acta-punto">. Derecho a que se le hagan saber los hechos atribu√≠dos y evidencias en su contra.</div>
                        <div class="acta-punto">. Derecho a solicitar diligencias probatorias √∫tiles para su defensa.</div>
                        
                        <p>En Rosario, a la fecha <strong>${hoy}</strong>, ante quien suscribe, se notifica de los derechos a <strong>${r.nombreCompleto}</strong>, nacionalidad <strong>${r.nacionalidad}</strong>, nacido el d√≠a <strong>${fechaN}</strong>, D.N.I. N¬∫ <strong>${r.dni}</strong>, hijo de <strong>${r.padre}</strong> y de <strong>${r.madre}</strong>, domiciliado en calle <strong>${r.domicilio}</strong>. Manifiesta que <strong>SI SABE LEER Y ESCRIBIR</strong>, y se desempe√±a como <strong>DESOCUPADO</strong>.</p>
                        
                        <p>Consultado sobre abogado defensor refiere que: <strong>SI, A POSTERIOR DESIGNARA UNO DE SU CONFIANZA</strong>.</p>
                        
                        <p>Se le notifica que se encuentra imputado por el delito de ‚Äú<strong>"${r.causaFinal}"</strong>‚Äù aprehendido el <strong>${fechaA}</strong>; a disposici√≥n del <strong>${r.fiscalia}</strong>, quien ordena que el mismo <strong>${r.orden}</strong>.</p>
                        
                        <p>En este acto se hace entrega de una copia de la presente acta al imputado.</p>
                        <div class="p-firma" style="margin-top:20px">${r.sumariante}<br>COMISARIA 2¬∞ URII</div>
                    </div>`;
            }
            else if(tipo === 'const_domicilio') {
                area.innerHTML = `<div class="print-doc"><div class="p-fecha">${hoy}</div><h2 style="text-align:center; text-decoration:underline; font-size:12pt">ACTA DE CONSTITUCI√ìN DE DOMICILIO</h2><div class="p-cuerpo" style="text-align: justify;">En la ciudad de Rosario, a los <strong>${hoy}</strong>, el funcionario Policial Actuante hace constar: Que por orden del DEFENSOR PENAL EN TURNO, se manda a comparecer a despacho a <strong>${r.nombreCompleto}</strong>, D.N.I. N¬∫ <strong>${r.dni}</strong>, domiciliado en <strong>${r.domicilio}</strong>, a quien se lo notifica que deber√° comparecer en calle SARMIENTO 2850 DEFENSORIA PUBLICA, pr√≥ximo dia habil (08:00hs a 19:00hs), a fin de constituir domicilio. Se da por finalizado el acto firmando de conformidad.</div><div style="margin-top:40px; display:flex; justify-content:space-around; text-align:center;"><div>____________________<br>FIRMA NOTIFICADO</div><div>____________________<br>${r.sumariante}<br>COMISARIA 2¬∞ URII</div></div></div>`;
            }
            else if(tipo === 'prohibicion') {
                area.innerHTML = `
                    <div class="print-doc">
                        <div class="p-fecha">${hoy}</div>
                        <h2 style="text-align:center; text-decoration:underline; margin-bottom: 15px; font-size:12pt">ACTA DE NOTIFICACI√ìN PROHIBICION DE ACERCAMIENTO</h2>
                        <div class="p-cuerpo" style="text-align: justify;">
                            En Rosario a los <strong>${hoy}</strong>, se notifica a <strong>${r.nombreCompleto}</strong>, D.N.I. N¬∫ <strong>${r.dni}</strong>, que por ORDEN DE <strong>${r.fiscalia}</strong>, se dispone la <strong>PROHIBICI√ìN DE ACERCAMIENTO AL DOMICILIO POR 72 HS en un RADIO DE 300 METROS E IMPEDIMENTO DE CONTACTO A ${r.victima}</strong>, domicilio en <strong>${r.domicilioVictima}</strong>. Consultado si entiende lo expuesto el mismo responde que SI. Firma para constancia.
                        </div>
                        <div class="p-firma" style="margin-top: 40px;">${r.sumariante}<br>COMISARIA 2¬∞ URII</div>
                    </div>`;
            }
            else if(tipo === 'entrega_rodado') {
                area.innerHTML = `<div class="print-doc"><div class="p-fecha">${hoy}</div><h2 style="text-align:center; text-decoration:underline; font-size:12pt">ACTA DE ENTREGA DE RODADO</h2><p>Se hace entrega del rodado secuestrado a <strong>${r.nombreCompleto}</strong>, D.N.I. N¬∫ <strong>${r.dni}</strong>.</p><p>DETALLE: <strong>${r.secuestro}</strong></p><div class="p-firma" style="margin-top:4cm">${r.sumariante}<br>COMISARIA 2¬∞ URII</div></div>`;
            }
            else if(tipo === 'nota_medico') {
                area.innerHTML = `<div class="print-doc"><div class="p-fecha">${hoy}</div><p><strong>SE√ëOR JEFE DEL RECONOCIMIENTO M√âDICO POLICIAL</strong></p><p>Solicito examen m√©dico para el demorado <strong>${r.nombreCompleto}</strong>, D.N.I. <strong>${r.dni}</strong>.</p><div class="p-firma" style="margin-top:5cm">${r.sumariante}<br>COMISARIA 2¬∞ URII</div></div>`;
            }
            else if(tipo === 'notificacion') {
                area.innerHTML = `<div class="print-doc"><div class="p-fecha">${hoy}</div><h2 style="text-align:center; text-decoration:underline; font-size:12pt">ACTA DE NOTIFICACI√ìN</h2><p>Se notifica a <strong>${r.nombreCompleto}</strong> de: ___________________________________________________________________</p><div class="p-firma" style="margin-top:5cm">${r.sumariante}</div></div>`;
            }
            else if(tipo === 'entrega_pert') {
                area.innerHTML = `<div class="print-doc"><div class="p-fecha">${hoy}</div><h2 style="text-align:center; text-decoration:underline; margin-bottom: 15px; font-size:12pt">ACTA DE ENTREGA DE PERTENENCIAS</h2><div style="text-align: justify;">En Rosario a los <strong>${hoy}</strong>, se hace entrega a <strong>${r.nombreCompleto}</strong>, D.N.I. N¬∫ <strong>${r.dni}</strong>, de los elementos en custodia: <strong>${r.pertenencias}</strong>. Firma de conformidad.</div><div style="margin-top:60px; display:flex; justify-content:space-around; text-align:center;"><div>__________________________<br>FIRMA DEL RECEPTOR</div><div>____________________<br>${r.sumariante}<br>COMISARIA 2¬∞ URII</div></div></div>`;
            }

            window.print();
        }

        async function exportarExcel() {
            const wb = new ExcelJS.Workbook();
            const sh = wb.addWorksheet('REGISTRO');
            sh.addRow(["NOMBRE", "DNI", "CAUSA FINAL", "FISCALIA"]);
            db.forEach(r => sh.addRow([r.nombreCompleto, r.dni, r.causaFinal, r.fiscalia]));
            const buffer = await wb.xlsx.writeBuffer();
            saveAs(new Blob([buffer]), "BASE_COMISARIA.xlsx");
        }

        document.addEventListener('DOMContentLoaded', () => {
            const fechaApreh = document.getElementById('fechaApreh');
            if (fechaApreh && !fechaApreh.value) {
                const hoy = new Date().toISOString().split('T')[0];
                fechaApreh.value = hoy;
            }
        });

        document.getElementById('nombreCompleto').addEventListener('input', function(e) {
            const busqueda = e.target.value.toUpperCase();
            if (busqueda.length < 5) return; 

            const record = db.find(r => r.nombreCompleto && r.nombreCompleto.includes(busqueda));

            if (record) {
                const camposAMemoria = [
                    'dni', 'apodo', 'padre', 'madre', 'fechaNac', 
                    'edad', 'estadoCivil', 'nacionalidad', 'domicilio', 'ciudad', 'provincia'
                ];

                camposAMemoria.forEach(campo => {
                    const el = document.getElementById(campo);
                    if (el && (!el.value || el.value === "SOLTERO" || el.value === "ARGENTINO" || el.value === "NO TIENE")) {
                        el.value = record[campo] || el.value;
                    }
                });
                e.target.style.border = "2px solid var(--success)";
            } else {
                e.target.style.border = "1px solid var(--border)";
            }
        });

        document.getElementById('fechaNac').addEventListener('change', function(e) {
            if (!e.target.value) return;
            const nac = new Date(e.target.value);
            const hoy = new Date();
            let edadCalculada = hoy.getFullYear() - nac.getFullYear();
            const m = hoy.getMonth() - nac.getMonth();
            if (m < 0 || (m === 0 && hoy.getDate() < nac.getDate())) {
                edadCalculada--;
            }
            document.getElementById('edad').value = edadCalculada;
        });
    </script>
</body>
</html>